<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checker Twitch Lives</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 800px; margin: 0 auto; padding: 20px; 
            background: #18181b; color: #e4e4e7; 
        }
        h1 { text-align: center; color: #9146ff; margin-bottom: 30px; }
        .input-section { margin-bottom: 20px; }
        input { 
            width: 70%; padding: 12px; border: 1px solid #404040; border-radius: 8px; 
            background: #27272a; color: #e4e4e7; font-size: 16px; 
        }
        input::placeholder { color: #a1a1aa; }
        button { 
            padding: 12px 24px; background: #9146ff; color: white; border: none; 
            border-radius: 8px; cursor: pointer; font-size: 16px; margin-left: 10px; 
        }
        button:hover { background: #8134e7; }
        .streams-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; margin-top: 20px; 
        }
        .stream-card { 
            background: #27272a; border-radius: 12px; padding: 5px; 
            border: 1px solid #404040; position: relative; overflow: hidden; 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        .stream-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(145, 70, 255, 0.3); }
        .thumbnail { 
            width: 100%; height: 200px; object-fit: cover; border-radius: 8px; 
            margin-bottom: 12px; display: block; 
        }
        .thumbnail-placeholder { 
            width: 100%; height: 200px; background: linear-gradient(135deg, #404040, #27272a); 
            border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; 
            justify-content: center; color: #a1a1aa; font-size: 14px; text-align: center; 
        }
        .avatar-container { 
            position: relative; width: 50px; height: 50px; margin-right: 12px; float: left; 
        }
        .avatar-img { 
            width: 50px; height: 50px; border-radius: 50%; object-fit: cover; 
            display: block; 
        }
        .avatar-placeholder { 
            width: 50px; height: 50px; border-radius: 50%; 
            background: #9146ff; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; color: white; font-size: 18px; 
            position: absolute; top: 0; left: 0; display: none; 
        }
        .stream-header { display: flex; align-items: flex-start; margin-bottom: 12px; }
        .username { font-weight: bold; font-size: 18px; color: #e4e4e7; }
        .viewer-dot { 
            width: 8px; height: 8px; background: #22c55e; border-radius: 50%; 
            margin: 0 8px; display: inline-block; 
        }
        .viewers { color: #a1a1aa; font-size: 14px; }
        .title { 
            color: #f4f4f5; font-size: 14px; line-height: 1.4; 
            margin-top: 4px; display: -webkit-box; -webkit-line-clamp: 3; 
            -webkit-box-orient: vertical; overflow: hidden; 
            padding: 0 5px 5px 5px;
        }
        .offline { 
            background: #27272a; opacity: 0.6; 
            border-color: #ef4444; 
        }
        .offline .username { color: #ef4444; }
        .offline .viewer-dot { background: #ef4444; }
        .offline .avatar-placeholder { background: #ef4444; }
        .error { color: #f59e0b; font-style: italic; text-align: center; padding: 20px; }
        .loading { text-align: center; color: #a1a1aa; }
    </style>
</head>
<body>
    <h1>Verificar Múltiplos Streamers na Twitch</h1>
    <div class="input-section">
        <input type="text" id="usernames" placeholder="Digite usernames separados por vírgula (ex: yoda,gaules,baianinho)" value="yoda,gaules,baianinho">
        <button onclick="checkStreams()">Verificar Todos</button>
    </div>
    <div id="result" class="streams-grid"></div>

    <script>
        async function checkStream(username) {
            username = username.toLowerCase().trim();
            if (!username) return null;

            const query = `
                query {
                    channel(name: "${username}") {
                        stream {
                            viewersCount
                            previewImageURL(width: 640, height: 360)
                            broadcaster {
                                displayName
                                profileImageURL(width: 300)
                                broadcastSettings {
                                    title
                                }
                            }
                        }
                    }
                }
            `;

            const targetUrl = 'https://gql.twitch.tv/gql';
            const proxyUrl = `https://corsproxy.io/?url=${encodeURIComponent(targetUrl)}`;

            try {
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Client-ID': 'kimne78kx3ncx6brgo4mv6wki5h1ko'
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) throw new Error(`HTTP: ${response.status}`);

                const data = await response.json();
                if (data.errors && data.errors.length > 0) {
                    throw new Error(`GraphQL: ${data.errors[0].message}`);
                }

                const channel = data.data?.channel;
                if (!channel || !channel.stream) {
                    return { online: false, username };
                }

                const stream = channel.stream;
                return {
                    online: true,
                    username: stream.broadcaster.displayName || username,
                    title: stream.broadcaster.broadcastSettings.title || 'Título não encontrado',
                    viewers: stream.viewersCount,
                    profileImageURL: stream.broadcaster.profileImageURL || '',
                    thumbnail: stream.previewImageURL || ''
                };
            } catch (error) {
                console.error(`Erro para ${username}:`, error);
                return { online: false, username, error: error.message };
            }
        }

        async function checkStreams() {
            const input = document.getElementById('usernames').value;
            const usernames = input.split(',').map(u => u.trim()).filter(u => u);
            if (usernames.length === 0) return alert('Digite pelo menos um username!');

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="loading">Carregando streams...</div>';

            const streams = await Promise.all(usernames.map(checkStream));
            renderStreams(streams);
        }

        function renderStreams(streams) {
            const resultDiv = document.getElementById('result');
            if (streams.every(s => !s.online && !s.error)) {
                resultDiv.innerHTML = '<p class="error">Nenhum streamer online ou erro na consulta. Tente novamente!</p>';
                return;
            }

            resultDiv.innerHTML = streams.map(stream => {
                const isOnline = stream.online;
                const className = isOnline ? '' : 'offline';
                const avatarEmoji = stream.username.charAt(0).toUpperCase();
                const viewersText = isOnline ? `${stream.viewers.toLocaleString()} Espectadores` : 'Offline';
                const dotColor = isOnline ? '#22c55e' : '#ef4444';
                const hasAvatar = isOnline && stream.profileImageURL;
                const hasThumbnail = isOnline && stream.thumbnail;

                if (stream.error) {
                    return `<div class="stream-card ${className}"><p class="error">Erro em ${stream.username}: ${stream.error}</p></div>`;
                }

                return `
                    <div class="stream-card ${className}">
                        ${hasThumbnail ? `<img class="thumbnail" src="${stream.thumbnail}" alt="Thumbnail da live de ${stream.username}" onerror="this.style.display='none'; this.parentElement.insertBefore(document.createElement('div'), this).className='thumbnail-placeholder'; this.remove();">` : '<div class="thumbnail-placeholder">Thumbnail não disponível</div>'}
                        <div class="stream-header">
                            <div class="avatar-container">
                                ${hasAvatar ? `<img class="avatar-img" src="${stream.profileImageURL}" alt="Avatar de ${stream.username}" onerror="this.style.display='none'; this.parentElement.querySelector('.avatar-placeholder').style.display='flex';">` : ''}
                                <div class="avatar-placeholder" style="background: ${dotColor};">${avatarEmoji}</div>
                            </div>
                            <div>
                                <div class="username">${stream.username}</div>
                                <div style="display: flex; align-items: center; margin-top: 4px;">
                                    <span class="viewer-dot" style="background: ${dotColor};"></span>
                                    <span class="viewers">${viewersText}</span>
                                </div>
                            </div>
                        </div>
                        <div class="title">${stream.title}</div>
                    </div>
                `;
            }).join('');
        }

        // Auto-check no load com exemplo
        window.onload = () => checkStreams();
    </script>
</body>
</html>